{% extends 'core/base.html' %}

{% block title %}Détails Produit : {{ product.name }} | NayxusStock{% endblock %}

{% block content %}
<div class="page-header">
    <div class="header-title">
        <h1 class="page-title">Détails du Produit</h1>
    </div>
    <div class="header-actions">
        <a href="{% url 'product_edit' product.pk %}" class="btn btn-primary">
            <i class="fas fa-edit"></i> Modifier
        </a>
        <a href="{% url 'product_list' %}" class="btn btn-outline">
            <i class="fas fa-arrow-left"></i> Retour aux produits
        </a>
    </div>
</div>

<div class="detail-container"
    style="display: flex; gap: 30px; background-color: var(--bg-secondary); padding: 30px; border-radius: 12px; border: 1px solid var(--border-color);">
    <div class="detail-image"
        style="flex: 1; max-width: 400px; background-color: var(--bg-primary); border-radius: 8px; overflow: hidden; display: flex; align-items: center; justify-content: center; height: 400px; border: 1px solid var(--border-color);">
        {% if product.image %}
        <img src="{{ product.image.url }}" alt="{{ product.name }}"
            style="width: 100%; height: 100%; object-fit: cover;">
        {% else %}
        <i class="fas fa-box" style="font-size: 8rem; color: var(--text-secondary);"></i>
        {% endif %}
    </div>

    <div class="detail-info" style="flex: 2;">
        <h2 style="font-size: 2rem; margin-bottom: 20px; color: var(--text-primary);">{{ product.name }}</h2>

        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
            <div class="info-group">
                <label
                    style="display: block; color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 5px;">Catégorie</label>
                <div style="font-weight: 600; font-size: 1.1rem;">{{ product.category.name }}</div>
            </div>

            <div class="info-group">
                <label
                    style="display: block; color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 5px;">Code-barre</label>
                <div style="font-weight: 600; font-size: 1.1rem;">{{ product.barcode|default:"—" }}</div>
            </div>

            <div class="info-group">
                <label style="display: block; color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 5px;">Prix
                    d'achat</label>
                <div style="font-weight: 600; font-size: 1.1rem;">{{ product.purchase_price }} FCFA</div>
            </div>

            <div class="info-group">
                <label style="display: block; color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 5px;">Prix
                    de vente</label>
                <div style="font-weight: 600; font-size: 1.1rem; color: var(--accent);">{{ product.selling_price }} FCFA
                </div>
            </div>

            <div class="info-group">
                <label
                    style="display: block; color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 5px;">Stock
                    Actuel</label>
                <div
                    style="font-weight: 600; font-size: 1.1rem; {% if product.is_low_stock %}color: #ef4444;{% endif %}">
                    {{ product.quantity }}
                    {% if product.is_low_stock %}
                    <small style="font-weight: 400; font-size: 0.8rem; margin-left: 10px;">(Seuil : {{
                        product.alert_threshold }})</small>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="info-group" style="margin-top: 30px;">
            <label
                style="display: block; color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 5px;">Description</label>
            <div style="line-height: 1.6;">{{ product.description|linebreaks|default:"Aucune description disponible." }}
            </div>
        </div>
    </div>
</div>

<div class="movements-section" style="margin-top: 40px;">
    <h3 style="margin-bottom: 20px;">Derniers mouvements de stock</h3>
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Type</th>
                    <th>Quantité</th>
                    <th>Motif</th>
                </tr>
            </thead>
            <tbody>
                {% for movement in product.movements.all|dictsortreversed:"date"|slice:":10" %}
                <tr class="data-row">
                    <td>{{ movement.date|date:"d/m/Y H:i" }}</td>
                    <td>
                        {% if movement.movement_type == 'ENTRY' %}
                        <span class="status-badge"
                            style="background: rgba(16, 185, 129, 0.1); color: #10b981; border-color: rgba(16, 185, 129, 0.2);">Entrée</span>
                        {% elif movement.movement_type == 'EXIT' %}
                        <span class="status-badge"
                            style="background: rgba(239, 68, 68, 0.1); color: #ef4444; border-color: rgba(239, 68, 68, 0.2);">Sortie</span>
                        {% else %}
                        <span class="status-badge"
                            style="background: rgba(59, 130, 246, 0.1); color: #3b82f6; border-color: rgba(59, 130, 246, 0.2);">Ajustement</span>
                        {% endif %}
                    </td>
                    <td>{{ movement.quantity }}</td>
                    <td>{{ movement.reason|default:"—" }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" style="text-align: center; color: var(--text-secondary);">Aucun mouvement enregistré
                        pour ce produit.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}