{% extends 'core/base.html' %}
{% load static %}

{% block title %}Dashboard | NayxusStock{% endblock %}

{% block content %}
<div class="page-header">
    <div class="header-title">
        <h1 class="page-title">{{ title }}</h1>
        <p style="color: var(--text-secondary); margin-top: 5px;">Bienvenue, {{ user.username }}. Voici un aperçu de
            votre activité.</p>
    </div>
</div>

<!-- Stats Grid -->
<div
    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 30px;">
    <!-- Revenue -->
    <div
        style="background: var(--bg-secondary); padding: 25px; border-radius: 12px; border: 1px solid var(--border-color); display: flex; align-items: center; gap: 20px;">
        <div
            style="width: 50px; height: 50px; background: rgba(16, 185, 129, 0.1); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #10b981; font-size: 1.5rem;">
            <i class="fas fa-money-bill-wave"></i>
        </div>
        <div>
            <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 5px;">Revenu (ce mois)</p>
            <h2 style="font-size: 1.5rem; font-weight: 700;">{{ revenue|floatformat:0 }} FCFA</h2>
        </div>
    </div>

    <!-- Stock Value -->
    <div
        style="background: var(--bg-secondary); padding: 25px; border-radius: 12px; border: 1px solid var(--border-color); display: flex; align-items: center; gap: 20px;">
        <div
            style="width: 50px; height: 50px; background: rgba(59, 130, 246, 0.1); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #3b82f6; font-size: 1.5rem;">
            <i class="fas fa-boxes"></i>
        </div>
        <div>
            <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 5px;">Valeur du Stock</p>
            <h2 style="font-size: 1.5rem; font-weight: 700;">{{ stock_value|floatformat:0 }} FCFA</h2>
        </div>
    </div>

    <!-- Alerts -->
    <div
        style="background: var(--bg-secondary); padding: 25px; border-radius: 12px; border: 1px solid var(--border-color); display: flex; align-items: center; gap: 20px;">
        <div
            style="width: 50px; height: 50px; background: rgba(239, 68, 68, 0.1); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #ef4444; font-size: 1.5rem;">
            <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div>
            <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 5px;">Alertes Stock</p>
            <h2 style="font-size: 1.5rem; font-weight: 700;">{{ low_stock_count }}</h2>
        </div>
    </div>

    <!-- Customers -->
    <div
        style="background: var(--bg-secondary); padding: 25px; border-radius: 12px; border: 1px solid var(--border-color); display: flex; align-items: center; gap: 20px;">
        <div
            style="width: 50px; height: 50px; background: rgba(139, 92, 246, 0.1); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #8b5cf6; font-size: 1.5rem;">
            <i class="fas fa-users"></i>
        </div>
        <div>
            <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 5px;">Clients Totaux</p>
            <h2 style="font-size: 1.5rem; font-weight: 700;">{{ customer_count }}</h2>
        </div>
    </div>
</div>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
    <!-- Recent Sales -->
    <div
        style="background: var(--bg-secondary); padding: 25px; border-radius: 12px; border: 1px solid var(--border-color);">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="font-size: 1.1rem; font-weight: 600;">Ventes Récentes</h3>
            <a href="{% url 'sales_list' %}"
                style="color: var(--accent); font-size: 0.85rem; text-decoration: none;">Voir tout</a>
        </div>
        <table style="width: 100%; border-collapse: collapse;">
            <tbody>
                {% for sale in recent_sales %}
                <tr style="border-bottom: 1px solid var(--border-color);">
                    <td style="padding: 12px 0;">
                        <p style="font-weight: 600; font-size: 0.95rem;">{{ sale.customer.name }}</p>
                        <p style="color: var(--text-secondary); font-size: 0.8rem;">Facture #{{ sale.number }}</p>
                    </td>
                    <td style="padding: 12px 0; text-align: right;">
                        <p style="font-weight: 600; color: #10b981;">+{{ sale.total_amount }} FCFA</p>
                        <p style="color: var(--text-secondary); font-size: 0.8rem;">{{ sale.date|date:"d/m/Y" }}</p>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="2" style="padding: 20px; text-align: center; color: var(--text-secondary);">Aucune
                        vente récente.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Recent Movements -->
    <div
        style="background: var(--bg-secondary); padding: 25px; border-radius: 12px; border: 1px solid var(--border-color);">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="font-size: 1.1rem; font-weight: 600;">Mouvements Stock</h3>
            <a href="{% url 'stock_movement_list' %}"
                style="color: var(--accent); font-size: 0.85rem; text-decoration: none;">Voir tout</a>
        </div>
        <table style="width: 100%; border-collapse: collapse;">
            <tbody>
                {% for move in recent_movements %}
                <tr style="border-bottom: 1px solid var(--border-color);">
                    <td style="padding: 12px 0;">
                        <p style="font-weight: 600; font-size: 0.95rem;">{{ move.product.name }}</p>
                        <p style="color: var(--text-secondary); font-size: 0.8rem;">{{ move.get_movement_type_display }}
                        </p>
                    </td>
                    <td style="padding: 12px 0; text-align: right;">
                        <p
                            style="font-weight: 600; {% if move.movement_type == 'ENTRY' %}color: #10b981;{% else %}color: #ef4444;{% endif %}">
                            {% if move.movement_type == 'ENTRY' %}+{% else %}-{% endif %}{{ move.quantity }}
                        </p>
                        <p style="color: var(--text-secondary); font-size: 0.8rem;">{{ move.date|date:"H:i" }}</p>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="2" style="padding: 20px; text-align: center; color: var(--text-secondary);">Aucun
                        mouvement récent.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Low Stock Alerts -->
<div
    style="margin-top: 20px; background: var(--bg-secondary); padding: 25px; border-radius: 12px; border: 1px solid var(--border-color);">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h3 style="font-size: 1.1rem; font-weight: 600; color: #ef4444;">
            <i class="fas fa-exclamation-triangle"></i> Alertes Stock Bas
        </h3>
        <a href="{% url 'product_list' %}?status=low_stock"
            style="color: var(--accent); font-size: 0.85rem; text-decoration: none;">Voir tout</a>
    </div>
    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;">
        {% for product in low_stock_products %}
        <div
            style="background: var(--bg-primary); padding: 15px; border-radius: 8px; border: 1px solid var(--border-color);">
            <p style="font-weight: 600; font-size: 0.9rem;">{{ product.name }}</p>
            <p style="color: var(--text-secondary); font-size: 0.8rem; margin-top: 5px;">
                Stock: <span style="color: #ef4444; font-weight: 700;">{{ product.quantity }}</span> (Seuil: {{
                product.alert_threshold }})
            </p>
        </div>
        {% empty %}
        <p style="color: var(--text-secondary); font-size: 0.9rem;">Aucune alerte de stock critique.</p>
        {% endfor %}
    </div>
</div>
{% endblock %}